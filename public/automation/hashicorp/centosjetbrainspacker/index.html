<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.74.3" />
    <meta name="description" content="Documentation">
<meta name="author" content="Greg Notch">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Centos JetBrains Packer :: Documentation</title>

    
    <link href="/css/nucleus.css?1597591925" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1597591925" rel="stylesheet">
    <link href="/css/hybrid.css?1597591925" rel="stylesheet">
    <link href="/css/featherlight.min.css?1597591925" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1597591925" rel="stylesheet">
    <link href="/css/auto-complete.css?1597591925" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1597591925" rel="stylesheet">
    <link href="/css/theme.css?1597591925" rel="stylesheet">
    <link href="/css/hugo-theme.css?1597591925" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1597591925"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/automation/hashicorp/centosjetbrainspacker/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <i class="fas fa-file-alt fa-3x"></i>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1597591925"></script>
<script type="text/javascript" src="/js/auto-complete.js?1597591925"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1597591925"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

          
          
          




 
  
    
    <li data-nav-id="/automation/" title="Automation" class="dd-item 
        parent
        
        
        ">
      <a href="/automation/">
          Automation
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/automation/ansible/" title="Ansible" class="dd-item ">
        <a href="/automation/ansible/">
        Ansible
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/automation/hashicorp/" title="Hashicorp" class="dd-item 
        parent
        
        
        ">
      <a href="/automation/hashicorp/">
          Hashicorp
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/automation/hashicorp/centosjetbrainspacker/" title="Centos JetBrains Packer" class="dd-item active">
        <a href="/automation/hashicorp/centosjetbrainspacker/">
        Centos JetBrains Packer
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/automation/hashicorp/cloudinit/" title="Cloudinit" class="dd-item ">
        <a href="/automation/hashicorp/cloudinit/">
        Cloudinit
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/automation/hashicorp/terraform/" title="Hashicorp Terraform" class="dd-item ">
        <a href="/automation/hashicorp/terraform/">
        Hashicorp Terraform
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/automation/hashicorp/vault/" title="Hashicorp Vault" class="dd-item ">
        <a href="/automation/hashicorp/vault/">
        Hashicorp Vault
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/automation/hashicorp/vanillapackeresxscripts/" title="Vanilla Packer ESX Scripts" class="dd-item ">
        <a href="/automation/hashicorp/vanillapackeresxscripts/">
        Vanilla Packer ESX Scripts
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/automation/hashicorp/vmwaregovccloudinit/" title="Vmware Govc Cloudinit" class="dd-item ">
        <a href="/automation/hashicorp/vmwaregovccloudinit/">
        Vmware Govc Cloudinit
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/automation/katello/" title="Katello" class="dd-item 
        
        
        
        ">
      <a href="/automation/katello/">
          Katello
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/automation/katello/foremanusage/" title="Foreman Usage" class="dd-item ">
        <a href="/automation/katello/foremanusage/">
        Foreman Usage
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/automation/katello/katellocentos7/" title="Katello CentOS 7" class="dd-item ">
        <a href="/automation/katello/katellocentos7/">
        Katello CentOS 7
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/automation/katello/katellocentos8/" title="Katello CentOS 8" class="dd-item ">
        <a href="/automation/katello/katellocentos8/">
        Katello CentOS 8
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/automation/katello/katellosetup/" title="Katello Setup" class="dd-item ">
        <a href="/automation/katello/katellosetup/">
        Katello Setup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/automation/katello/katellousage/" title="Katello Usage" class="dd-item ">
        <a href="/automation/katello/katellousage/">
        Katello Usage
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/automation/katello/puppet/" title="Puppet" class="dd-item ">
        <a href="/automation/katello/puppet/">
        Puppet
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/aws/" title="AWS" class="dd-item 
        
        
        
        ">
      <a href="/aws/">
          AWS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/docker/" title="Docker" class="dd-item 
        
        
        
        ">
      <a href="/docker/">
          Docker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/docker/dockerbasics/" title="Docker Basics" class="dd-item ">
        <a href="/docker/dockerbasics/">
        Docker Basics
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docker/dockersetup/" title="Docker Setup" class="dd-item ">
        <a href="/docker/dockersetup/">
        Docker Setup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/gcp/" title="Google Cloud Platform" class="dd-item 
        
        
        
        ">
      <a href="/gcp/">
          Google Cloud Platform
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/gcp/setup/" title="GCP Setup" class="dd-item ">
        <a href="/gcp/setup/">
        GCP Setup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/kubernetes/" title="Kubernetes" class="dd-item 
        
        
        
        ">
      <a href="/kubernetes/">
          Kubernetes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/kubernetes/rancher/" title="Rancher" class="dd-item ">
        <a href="/kubernetes/rancher/">
        Rancher
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/linux/" title="Linux" class="dd-item 
        
        
        
        ">
      <a href="/linux/">
          Linux
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/linux/centosconfig/" title="Centos Config" class="dd-item ">
        <a href="/linux/centosconfig/">
        Centos Config
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/linux/ipcmd/" title="ip command" class="dd-item ">
        <a href="/linux/ipcmd/">
        ip command
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/linux/powerline/" title="Powerline" class="dd-item ">
        <a href="/linux/powerline/">
        Powerline
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/linux/randomunixgems/" title="Random Unix Gems" class="dd-item ">
        <a href="/linux/randomunixgems/">
        Random Unix Gems
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/linux/tmux/" title="Tmux" class="dd-item ">
        <a href="/linux/tmux/">
        Tmux
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/linux/ubuntuconfig/" title="Ubuntu Config" class="dd-item ">
        <a href="/linux/ubuntuconfig/">
        Ubuntu Config
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/linux/zsh/" title="Zsh" class="dd-item ">
        <a href="/linux/zsh/">
        Zsh
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/mac/" title="Mac" class="dd-item 
        
        
        
        ">
      <a href="/mac/">
          Mac
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/mac/appleremotedesktop/" title="Apple Remote Desktop" class="dd-item ">
        <a href="/mac/appleremotedesktop/">
        Apple Remote Desktop
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/mac/mackeychain/" title="Mac Keychain" class="dd-item ">
        <a href="/mac/mackeychain/">
        Mac Keychain
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/mac/randommacgems/" title="Random Mac Gems" class="dd-item ">
        <a href="/mac/randommacgems/">
        Random Mac Gems
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/azure/" title="Microsoft Azure" class="dd-item 
        
        
        
        ">
      <a href="/azure/">
          Microsoft Azure
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/azure/setup/" title="Azure Setup" class="dd-item ">
        <a href="/azure/setup/">
        Azure Setup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/miscellaneous/" title="Miscellaneous" class="dd-item 
        
        
        
        ">
      <a href="/miscellaneous/">
          Miscellaneous
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/miscellaneous/certificateauthority/" title="SSL / Certificate Authority" class="dd-item ">
        <a href="/miscellaneous/certificateauthority/">
        SSL / Certificate Authority
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/networking/" title="Networking" class="dd-item 
        
        
        
        ">
      <a href="/networking/">
          Networking
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/networking/arista/" title="Arista" class="dd-item ">
        <a href="/networking/arista/">
        Arista
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/networking/cisco3850/" title="Cisco 3850" class="dd-item ">
        <a href="/networking/cisco3850/">
        Cisco 3850
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/networking/iperf/" title="Iperf" class="dd-item ">
        <a href="/networking/iperf/">
        Iperf
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/networking/wiresharksslhandshake/" title="Wireshark SSL Handshake" class="dd-item ">
        <a href="/networking/wiresharksslhandshake/">
        Wireshark SSL Handshake
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/paloalto/" title="Palo Alto" class="dd-item 
        
        
        
        ">
      <a href="/paloalto/">
          Palo Alto
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/paloalto/paloclicheatsheet/" title="Palo Cheat Sheet" class="dd-item ">
        <a href="/paloalto/paloclicheatsheet/">
        Palo Cheat Sheet
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/paloalto/palonotes/" title="Palo Notes" class="dd-item ">
        <a href="/paloalto/palonotes/">
        Palo Notes
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/python/" title="Python" class="dd-item 
        
        
        
        ">
      <a href="/python/">
          Python
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/reverseengineering/" title="Reverse Engineering" class="dd-item 
        
        
        
        ">
      <a href="/reverseengineering/">
          Reverse Engineering
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/reverseengineering/ios-app-dump-decrypt/" title="IOS App Dump / Decrypt" class="dd-item ">
        <a href="/reverseengineering/ios-app-dump-decrypt/">
        IOS App Dump / Decrypt
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/reverseengineering/maclldbpythonfix/" title="XCode 11 LLDB Python 2" class="dd-item ">
        <a href="/reverseengineering/maclldbpythonfix/">
        XCode 11 LLDB Python 2
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vmware/" title="VMware" class="dd-item 
        
        
        
        ">
      <a href="/vmware/">
          VMware
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/vmware/govc/" title="govc" class="dd-item ">
        <a href="/vmware/govc/">
        govc
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/vmware/macvmware/" title="Mac VMware" class="dd-item ">
        <a href="/vmware/macvmware/">
        Mac VMware
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/vmware/nsxt/" title="NSX-T Links" class="dd-item ">
        <a href="/vmware/nsxt/">
        NSX-T Links
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/vmware/nsxt-networking/" title="NSX-T Networking" class="dd-item ">
        <a href="/vmware/nsxt-networking/">
        NSX-T Networking
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/vmware/ofv-ova/" title="OVF / OVA" class="dd-item ">
        <a href="/vmware/ofv-ova/">
        OVF / OVA
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/vmware/powercli/" title="PowerCLI" class="dd-item ">
        <a href="/vmware/powercli/">
        PowerCLI
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/vmware/upgrading/" title="Upgrading" class="dd-item ">
        <a href="/vmware/upgrading/">
        Upgrading
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/vmware/vmwareapi/" title="VMware APIs" class="dd-item ">
        <a href="/vmware/vmwareapi/">
        VMware APIs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/vmware/vmware-networking/" title="VMware Networking " class="dd-item ">
        <a href="/vmware/vmware-networking/">
        VMware Networking 
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/vmware/vsphereesxi/" title="VSphere / ESXi" class="dd-item ">
        <a href="/vmware/vsphereesxi/">
        VSphere / ESXi
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/windows/" title="Windows" class="dd-item 
        
        
        
        ">
      <a href="/windows/">
          Windows
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
          
          
            
            




 
  
    
      <li data-nav-id="/windows/azurenotes/" title="Azure Notes" class="dd-item ">
        <a href="/windows/azurenotes/">
        Azure Notes
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/windows/powershell/" title="Powershell" class="dd-item ">
        <a href="/windows/powershell/">
        Powershell
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/windows/windows10/" title="Windows 10" class="dd-item ">
        <a href="/windows/windows10/">
        Windows 10
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/windows/windowsserver/" title="Windows Server" class="dd-item ">
        <a href="/windows/windowsserver/">
        Windows Server
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p><i class="far fa-copyright"></i> 2019 - Greg Notch</p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Documentation</a> > <a href='/automation/'>Automation</a> > <a href='/automation/hashicorp/'>Hashicorp</a> > Centos JetBrains Packer
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#building-a-hardened-centos-vm-template-using-packer">Building a Hardened Centos VM Template using Packer</a>
      <ul>
        <li></li>
        <li><a href="#theory-of-operation">Theory of Operation</a></li>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#setup">Setup</a></li>
        <li><a href="#configuration">Configuration</a></li>
        <li><a href="#running-packer">running packer</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Centos JetBrains Packer
            </h1>
          

        


<table>
<thead>
<tr>
<th align="left">Date Added</th>
<th align="left">Description</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">2019-11-24</td>
<td align="left">Jetbrains Packer Builder Vsphere</td>
<td><a href="https://github.com/jetbrains-infra/packer-builder-vsphere">https://github.com/jetbrains-infra/packer-builder-vsphere</a></td>
</tr>
<tr>
<td align="left">2019-11-24</td>
<td align="left">VMware Guestinfo Cloud-Init</td>
<td><a href="https://github.com/vmware/cloud-init-vmware-guestinfo/releases">https://github.com/vmware/cloud-init-vmware-guestinfo/releases</a></td>
</tr>
</tbody>
</table>
<p>Centos Kickstart Reference | <a href="https://docs.centos.org/en-US/centos/install-guide/Kickstart2/">https://docs.centos.org/en-US/centos/install-guide/Kickstart2/</a> |
RHEL7 Kickstart Guide | <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/installation_guide/sect-simple-install-kickstart">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/installation_guide/sect-simple-install-kickstart</a>|</p>
<h2 id="building-a-hardened-centos-vm-template-using-packer">Building a Hardened Centos VM Template using Packer</h2>
<p>We are going to build for centos-7, which is not one of the examples that Jetbrains provides. However, there are several pull requests on the github repo which contain some examples to work from. At a high level, we&rsquo;re going to use packer to build a centos vm from a base ISO using kickstart, configure it further using cloud-init, and finally use packer provisioners to run some hardening scripts against it. The goal is a template vm (either in or out of a VMware Content Library) that can be provisioned via govc or terraform as a clone (linked or full)</p>
<h5 id="my-centos7-implementation-is-here-httpsgitnotchorgnotchvmware-automationtreemasterwinternotch-hardened-centos7">my centos7 implementation is here: <a href="https://git.notch.org/notch/vmware-automation/tree/master/winternotch-hardened-centos7">https://git.notch.org/notch/vmware-automation/tree/master/winternotch-hardened-centos7</a></h5>
<h3 id="theory-of-operation">Theory of Operation</h3>
<h5 id="packer-builder">Packer Builder</h5>
<p>This is the main packer scipt. The first part executes now (the builder part), and the rest executes after the image is built by kickstart and cloud-init (the provisioner part). Note that we use vault to store the credentials in the configuration file</p>
<ul>
<li>downloads the base ISO to packer_cache locally, validates the checksum,</li>
<li>takes the kickstart file (ks.cfg) and the cloud-init script (cloud-init.json) and builds a floppy image</li>
<li>logs into vcenter, and copies the iso and floppy image up to the data store specified.</li>
<li>configures the vm profile according to the parameters in the packer JSON</li>
<li>mounts the media (ISO and floppy image) on the VM</li>
<li>boots the vm and begins the installation</li>
</ul>
<h5 id="kickstart-config-kscfg">Kickstart Config (ks.cfg)</h5>
<p>This is a redhat format unattended install script which does the following:</p>
<ul>
<li>Boots unattended install of Centos</li>
<li>Configures disk geometry, etc.</li>
<li>Installs packages from the ISO</li>
<li>Configures the network (this is a temp config)</li>
<li>enables sshd, turns on the firewall</li>
<li>Adds the centos user with centos password (more on this later)</li>
<li>installs the cloud-init RPM</li>
<li>installs the special vmware-cloud-init-guestinfo RPM.
NOTE: you need a yum repo to serve this up. I store it on a katello server but really any yum repo will do, or you can point directly to the github repo if your environment has internet access
<code>https://github.com/vmware/cloud-init-vmware-guestinfo/releases/download/v1.1.0/cloud-init-vmware-guestinfo-1.1.0-1.el7.noarch.rpm</code> . you just need to make sure this repo is added to your ks.cfg.</li>
<li>Copies the initial cloud-init script. This is very important because the default cloud-init that comes with the rpm by default uses dhcp for IPs (which is fine, but doesnt allow it to work in non dhcp environments) Even more importantly it disables password based logins, which will prevent packer from being able to log into the vm and complete its provisioning run later. So we take this opportunity to lay down our own initial cloudinit config so we can control what happens on the next boot</li>
<li>once all of this is complete, kickstart ejects the removable media and reboots the machine</li>
</ul>
<h5 id="cloud-init-script">Cloud-Init Script</h5>
<p>This is the bootstrap cloud init script. Once kickstart reboots the machine and it comes up, cloud-init takes over the configuration of the machine.</p>
<ul>
<li>reconfigures centos user, adds a ssh key and maintains the centos password. really this will only ever be used to debug the image and the image creation process, which should be done in a controlled environment, so this is OK. Later on in the process we will remove this user entirely, probably with puppet.</li>
<li>disables the root user entirely</li>
<li>removes default sshd keys and certificates</li>
<li>sets up the network interface again</li>
</ul>
<p>It can do a lot more. There are seveal other things that should go here. Honestly you could probably put all of the rest of the stuff that gets executed by packer provisioners (see below) in the cloud-init script if you wanted to.</p>
<ul>
<li>yum repo configuration (point to internal repos)</li>
<li>puppet rpm installation from that repo</li>
<li>any other configuration management</li>
</ul>
<h5 id="packer-provisioner">Packer Provisioner</h5>
<p>This is the &ldquo;provisioner&rdquo; part of the Packer script. What we use this for is to ssh into the image as the centos user and execute a series of shell scripts as root using sudo. The reason we do it this way is because we&rsquo;ve already locked the root user down in previous steps. These scripts are designed to run on the image just prior to it being shut down, and handle genericization of the image. This includes</p>
<ul>
<li>SCAP lockdown and other OS hardening (auditd rules, selinux etc.)</li>
<li>remove any UUIDS, and reset MAC addresses so that the image is vanilla and unique when cloned</li>
<li>remove any log files or any other traces of the install process</li>
<li>remove lingering ssh keys for the centos user. (we still want the password for console access until the machine enters normal configuration management )</li>
<li>disable password authentication for sshd</li>
<li>zero out the filesystem so the image is smaller (optional)</li>
<li>put final desired version of cloud-init configuration in place</li>
</ul>
<p>Once this is complete, packer shuts down the image, and turns it into a template in vcenter that you can clone.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>vcenter server. API access required</li>
<li>esxi host (note that no ssh or vnc should be required on the host, you just need the name of one in the cluster to build on)</li>
<li>hashicorp vault
<ul>
<li>setup with credentials for vcenter server</li>
</ul>
</li>
<li>packer</li>
<li>jetbrains packer plugins installed in $HOME/.packer.d/plugins</li>
<li>yum repo of some sort to serve up custom rpms (potentially optional)</li>
<li>network connectivity between the location where scripts are run, the vcenter and esxi servers, and the DV-switch where the VM will reside (packer will log into the vm and run scripts)</li>
</ul>
<h3 id="setup">Setup</h3>
<h4 id="packer-script-json">packer script (json)</h4>
<p>for the vsphere configuration, there are a number of ways to do this, including standalone esx. This is just how I did it. the jetbrains git repo has more information, and the parameters you need might change depending on your approach)</p>
<ul>
<li>server name</li>
<li>vcenter username and password. I use vault, you can hardcode if you really want, but thats a <em>bad</em> idea.</li>
<li>datacenter name</li>
<li>datastore name (storage where you want the image to go, packer_cache will go there too )</li>
<li>cluster</li>
<li>esxi host (this is the host in the cluster that will do the build, must be in datacenter, and have access to the datastore)</li>
<li>ISO url and checksum (make sure this is up to date with current iso)</li>
</ul>
<h4 id="kscfg">ks.cfg</h4>
<p>network config (DHCP or static)</p>
<pre><code>network --device=eth0 --bootproto=dhcp --activate
network --device=eth0 --bootproto=static --ip=10.4.20.161 --netmask=255.255.255.0 --gateway=10.4.20.1 --nameserver=10.4.20.211 --hostname=centos7 --activate

</code></pre><p>yum repos</p>
<pre><code>repo --name=&quot;base&quot; --baseurl=&quot;http://mirror.centos.org/centos/$releasever/os/$basearch&quot;
repo --name=&quot;updates&quot; --baseurl=&quot;http://mirror.centos.org/centos/$releasever/updates/$basearch&quot;
repo --name=&quot;epel&quot; --baseurl=&quot;http://download.fedoraproject.org/pub/epel/$releasever/$basearch&quot;
repo --name=&quot;winternotch&quot; --baseurl=&quot;http://foreman.winternotch.com/pulp/repos/Default_Organization/Library/custom/Winternotch_Packages/Winternotch_Repo/&quot;
</code></pre><p>at the end, make sure the bootstrap cloud-init filename you are copying is correct</p>
<pre><code>cp /floppy/winternotch-cloud.cfg /mnt/sysimage/etc/cloud/cloud.cfg
</code></pre><h4 id="cloud-init-script-1">cloud-init script</h4>
<h4 id="building-jetbrains-packer-plugins-recommended">building jetbrains packer plugins (recommended)</h4>
<p>(requires docker)</p>
<pre><code>git clone https://github.com/jetbrains-infra/packer-builder-vsphere
cd packer-builder-vsphere
docker-compose run build
</code></pre><h4 id="install-plugins">install plugins</h4>
<p><a href="https://www.packer.io/docs/extending/plugins.html#installing-plugins">https://www.packer.io/docs/extending/plugins.html#installing-plugins</a></p>
<pre><code>cd packer-builder-vsphere
mkdir -p $HOME/.packer.d/plugins
cp bin/*.macos $HOME/.packer.d/plugins
</code></pre><h3 id="configuration">Configuration</h3>
<h4 id="example-configs">example configs</h4>
<p><a href="https://github.com/jetbrains-infra/packer-builder-vsphere/tree/master/examples/">https://github.com/jetbrains-infra/packer-builder-vsphere/tree/master/examples/</a></p>
<h4 id="centos-examples-unmerged-pulls">centos examples (unmerged pulls)</h4>
<p>centos8 : <a href="https://github.com/nelg/packer-builder-vsphere">https://github.com/nelg/packer-builder-vsphere</a></p>
<p>centos7 : <a href="https://github.com/remijouannet/packer-builder-vsphere">https://github.com/remijouannet/packer-builder-vsphere</a></p>
<h3 id="running-packer">running packer</h3>
<pre><code># normal build
packer build hardened-centos7.json

# force continuation if artifacts exist
packer build -force hardened-centos7.json

# dont destroy vm on abort (to debug errors)
packer build -on-error=abort hardened-centos7.json

# debug logging
PACKER_LOG=1 packer build -force hardened-centos7.json

# step by step debugging 
packer build -debug whardened-centos7.json
</code></pre>

<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/automation/hashicorp/" title="Hashicorp"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/automation/hashicorp/cloudinit/" title="Cloudinit" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1597591925"></script>
    <script src="/js/perfect-scrollbar.min.js?1597591925"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1597591925"></script>
    <script src="/js/jquery.sticky.js?1597591925"></script>
    <script src="/js/featherlight.min.js?1597591925"></script>
    <script src="/js/highlight.pack.js?1597591925"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1597591925"></script>
    <script src="/js/learn.js?1597591925"></script>
    <script src="/js/hugo-learn.js?1597591925"></script>

    <link href="/mermaid/mermaid.css?1597591925" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1597591925"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

